generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model likes {
  id         Int       @id @default(autoincrement())
  profile_id Int
  user_id    Int
  created_at DateTime? @default(now())
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  profiles   profiles  @relation(fields: [profile_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([profile_id, user_id])
  @@index([profile_id])
  @@index([user_id])
}

model media {
  id                                     Int        @id @default(autoincrement())
  profile_id                             Int?
  url                                    String
  type                                   String
  order_index                            Int?       @default(0)
  created_at                             DateTime?  @default(now())
  is_converting                          Boolean?   @default(false)
  conversion_error                       String?
  conversion_attempts                    Int?       @default(0)
  profiles_media_profile_idToprofiles    profiles?  @relation("media_profile_idToprofiles", fields: [profile_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  profiles_profiles_main_photo_idTomedia profiles[] @relation("profiles_main_photo_idTomedia")

  @@index([profile_id, type, order_index])
  @@index([order_index])
  @@index([type])
  @@index([profile_id])
}

model messages {
  id                                Int       @id @default(autoincrement())
  sender_id                         Int?
  receiver_id                       Int?
  content                           String
  created_at                        DateTime? @default(now())
  users_messages_receiver_idTousers users?    @relation("messages_receiver_idTousers", fields: [receiver_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_messages_sender_idTousers   users?    @relation("messages_sender_idTousers", fields: [sender_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([sender_id])
  @@index([receiver_id])
  @@index([created_at])
}

model payments {
  id            Int       @id @default(autoincrement())
  user_id       Int?
  amount_to_pay Float?
  credit_amount Float?
  payment_id    String?   @unique
  order_id      String?   @unique
  method        String?   @default("crypto")
  status        String?   @default("pending")
  created_at    DateTime? @default(now())
  users         users?    @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([status])
  @@index([created_at])
  @@index([user_id])
  @@index([order_id])
}

model profile_verifications {
  id                     Int       @id @default(autoincrement())
  profile_id             Int
  verification_code      String
  verification_photo_url String?
  status                 String?   @default("pending")
  created_at             DateTime? @default(now())
  reviewed_at            DateTime?
  reviewed_by            Int?
  users                  users?    @relation(fields: [reviewed_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  profiles               profiles  @relation(fields: [profile_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([created_at])
  @@index([status])
  @@index([profile_id])
}

model profiles {
  id                                  Int                     @id @default(autoincrement())
  user_id                             Int?
  name                                String
  age                                 Int?
  city                                String?
  height                              Int?
  weight                              Int?
  bust                                String?
  phone                               String?
  telegram                            String?
  whatsapp                            String?
  website                             String?
  currency                            String?                 @default("USD")
  price_30min                         Float?
  price_1hour                         Float?
  price_2hours                        Float?
  price_night                         Float?
  description                         String?
  services                            String?
  image_url                           String?
  main_photo_id                      Int?
  is_active                           Boolean?                @default(true)
  boost_expires_at                    DateTime?
  last_payment_at                     DateTime?
  created_at                          DateTime?               @default(now())
  is_verified                         Boolean?                @default(false)
  likes                               likes[]
  media_media_profile_idToprofiles    media[]                 @relation("media_profile_idToprofiles")
  profile_verifications               profile_verifications[]
  media_profiles_main_photo_idTomedia media?                  @relation("profiles_main_photo_idTomedia", fields: [main_photo_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users                               users?                  @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  reviews                             reviews[]

  @@index([is_active, city, boost_expires_at(sort: Desc), last_payment_at(sort: Desc), created_at(sort: Desc)])
  @@index([last_payment_at])
  @@index([boost_expires_at])
  @@index([created_at])
  @@index([city])
  @@index([is_active])
  @@index([user_id])
}

model reviews {
  id         Int      @id @default(autoincrement())
  user_id    Int
  profile_id Int
  comment    String
  created_at DateTime
  profiles   profiles @relation(fields: [profile_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users      users    @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([user_id, profile_id])
  @@index([created_at])
  @@index([user_id])
  @@index([profile_id])
}

model users {
  id                                   Int                     @id @default(autoincrement())
  name                                 String
  email                                String                  @unique
  password                             String
  balance                              Float?                  @default(0)
  account_type                         String?                 @default("model")
  created_at                           DateTime?               @default(now())
  reset_password_token                 String?
  reset_password_expires               DateTime?
  likes                                likes[]
  messages_messages_receiver_idTousers messages[]              @relation("messages_receiver_idTousers")
  messages_messages_sender_idTousers   messages[]              @relation("messages_sender_idTousers")
  payments                             payments[]
  profile_verifications                profile_verifications[]
  profiles                             profiles[]
  reviews                              reviews[]

  @@index([created_at])
  @@index([account_type])
  @@index([email])
}
