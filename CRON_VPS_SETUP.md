# Настройка Cron Job на VPS

## Шаг 1: Добавьте CRON_SECRET в .env

На вашем VPS сервере откройте файл `.env` и добавьте:

```env
CRON_SECRET="ваш_случайный_секретный_ключ"
```

**Важно**: Используйте длинный случайный ключ, например:
- Сгенерируйте на https://randomkeygen.com/
- Или придумайте свой, например: `kissblow_cron_2024_abc123xyz789`

## Шаг 2: Подключитесь к VPS по SSH

```bash
ssh ваш_пользователь@ваш_сервер
```

## Шаг 3: Настройте системный cron

Выполните команду:

```bash
crontab -e
```

Если появится вопрос о редакторе, выберите `nano` (нажмите Enter).

## Шаг 4: Добавьте строку в конец файла

Добавьте эту строку (замените `ваш_секретный_ключ` на значение из `.env`):

```bash
0 * * * * curl -H "Authorization: Bearer ваш_секретный_ключ" https://kissblow.me/api/cron/check-profile-subscriptions >/dev/null 2>&1
```

**Пример:**
```bash
0 * * * * curl -H "Authorization: Bearer kissblow_cron_2024_abc123xyz789" https://kissblow.me/api/cron/check-profile-subscriptions >/dev/null 2>&1
```

## Шаг 5: Сохраните и выйдите

- В **nano**: Нажмите `Ctrl+X`, затем `Y`, затем `Enter`
- В **vi**: Нажмите `Esc`, затем введите `:wq`, затем `Enter`

## Шаг 6: Проверьте, что cron job добавлен

Выполните:

```bash
crontab -l
```

Вы должны увидеть добавленную строку.

## Шаг 7: Тест (опционально)

Можете протестировать вручную:

```bash
curl -H "Authorization: Bearer ваш_секретный_ключ" https://kissblow.me/api/cron/check-profile-subscriptions
```

Должен вернуться JSON с результатами проверки.

---

## Что делает этот cron job?

- **Запускается каждый час** (в 00:00, 01:00, 02:00 и т.д.)
- **Проверяет все активные профили**
- **Списывает $1** у тех, у кого прошло 24 часа с последнего платежа
- **Поднимает профили наверх** после списания
- **Не деактивирует** профили при недостаточном балансе (просто пропускает)

---

## Готово!

Теперь автоматическое списание будет работать каждые 24 часа для всех активных профилей.




